<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Minga Match | Publicar Vacante</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

<header class="bg-slate-800 text-white shadow-md sticky top-0 z-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
            <div class="flex items-center">
                <img src="logo-minga.png" alt="Minga Match Logo" class="h-8 w-auto mr-3" id="logo-img"/>
                <span class="font-bold text-xl">Minga Match | Escuela</span>
            </div>
            <a href="#" onclick="redirectTo('/dashboard-school.html');" class="bg-white text-slate-800 font-bold py-2 px-4 rounded-lg hover:bg-slate-200 transition duration-300 text-sm">
                Volver al Dashboard
            </a>
        </div>
    </div>
</header>

<main class="max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <h1 class="text-3xl font-bold text-slate-900 mb-2">Publicar Nueva Vacante</h1>
    <p class="text-slate-600 mb-8">Define los requisitos y detalles del puesto para empezar a recibir candidatos filtrados por IA.</p>

    <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-slate-200">
        <form id="post-job-form" class="space-y-6">

            <div>
                <h2 class="text-xl font-semibold text-slate-700 mb-3 border-b pb-2">Detalles del Puesto</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    
                    <div>
                        <label for="title" class="block text-sm font-medium text-slate-700">Título del Puesto</label>
                        <input type="text" id="title" required placeholder="Ej: Profesor de Matemáticas (High School)" class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm">
                    </div>
                    
                    <div>
                        <label for="subject" class="block text-sm font-medium text-slate-700">Materia Principal Requerida</label>
                        <select id="subject" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm bg-white">
                            <option value="">Seleccionar</option>
                            <option value="matematicas">Matemáticas</option>
                            <option value="ciencias">Ciencias (Física, Química, Biología)</option>
                            <option value="espanol">Español / Bilingüe</option>
                            <option value="ingles">Inglés / ESL</option>
                            <option value="primaria">Educación Primaria</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>

                    <div>
                        <label for="grade-level" class="block text-sm font-medium text-slate-700">Nivel Educativo</label>
                        <input type="text" id="grade-level" placeholder="Ej: Middle School (Grados 6-8)" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm">
                    </div>

                    <div>
                        <label for="type" class="block text-sm font-medium text-slate-700">Tipo de Contrato</label>
                        <select id="type" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm bg-white">
                            <option value="full-time">Tiempo Completo</option>
                            <option value="part-time">Tiempo Parcial</option>
                        </select>
                    </div>
                </div>
            </div>

            <div>
                <h2 class="text-xl font-semibold text-slate-700 mb-3 border-b pb-2">Requisitos y Ubicación</h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="min-experience" class="block text-sm font-medium text-slate-700">Experiencia Mínima (Años)</label>
                        <input type="number" id="min-experience" min="2" required value="2" class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm">
                    </div>

                    <div>
                        <label for="description" class="block text-sm font-medium text-slate-700">Descripción Completa del Puesto y Requisitos</label>
                        <textarea id="description" rows="5" required placeholder="Describe las responsabilidades, la ubicación exacta y cualquier requisito de certificación específico del estado." class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm"></textarea>
                    </div>
                    
                    <div class="flex items-center gap-2 pt-2">
                        <input type="checkbox" id="is-bilingual" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                        <label for="is-bilingual" class="text-sm font-medium text-slate-700">¿Se requiere fluidez en Español/Inglés (Puesto Bilingüe)?</label>
                    </div>
                </div>
            </div>

            <p id="form-message" class="text-sm text-center text-red-600 h-5"></p>
            
            <button type="submit" id="submit-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 text-lg">
                Publicar Vacante Ahora
            </button>
        </form>
    </div>
</main>

<script>
    // CRÍTICO: Define la ruta base del repositorio
    const REPO_PATH = '/MingaMatch'; 
    
    // Función auxiliar para redirigir, asegurando la estabilidad de la ruta
    window.redirectTo = function(path) {
        window.location.href = REPO_PATH + path;
    };

    // --- Guardia de Sesión ---
    (function guard() {
        const token = localStorage.getItem('token');
        const role = localStorage.getItem('role');
        
        if (!token || (role !== 'school' && role !== 'admin')) {
            console.log('Sesión no válida o rol incorrecto. Redirigiendo a login.');
            window.location.href = REPO_PATH + '/login.html';
        }
    })();

    document.addEventListener('DOMContentLoaded', () => {
        // CRÍTICO: Corrección de la ruta del logo
        const logo = document.getElementById('logo-img');
        if (logo) {
            logo.src = REPO_PATH + '/logo-minga.png';
        }

        const form = document.getElementById('post-job-form');
        const submitButton = document.getElementById('submit-button');
        const messageElement = document.getElementById('form-message');
        
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            messageElement.textContent = '';
            
            const jobData = {
                title: document.getElementById('title').value,
                subject: document.getElementById('subject').value,
                minExperience: parseInt(document.getElementById('min-experience').value),
                description: document.getElementById('description').value,
                isBilingual: document.getElementById('is-bilingual').checked,
                // ... (otros campos)
            };

            submitButton.textContent = 'Publicando...';
            submitButton.disabled = true;

            // --- SIMULACIÓN DE POSTEO DE VACANTE ---
            setTimeout(() => {
                // SIMULACIÓN: Redirigir al dashboard con mensaje de éxito
                alert(`¡Vacante "${jobData.title}" publicada con éxito!`);
                window.location.href = REPO_PATH + '/dashboard-school.html';
            }, 1500);

        });
    });
</script>
</body>
</html>

