<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title data-i18n="teacherDashboardTitle"></title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/i18next/dist/umd/i18next.min.js" defer></script>
    <script src="i18n.js" defer></script> 
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Estilo para enlaces desbloqueados (quitamos el pointer-events-none) */
        .step-link.disabled {
            color: #94a3b8 !important; /* slate-400 */
        }
    </style>
</head>
<body class="bg-slate-50">

    <div class="min-h-screen flex flex-col">
        <header class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
                
                <a href="#" onclick="window.location.href = REPO_PATH + '/index.html';" class="flex items-center space-x-2">
                    <img src="logo-minga.png" alt="Minga Match Logo" class="h-8 w-auto"/>
                    <span class="text-xl font-bold text-blue-700">Minga Match</span>
                </a>

                <nav class="hidden md:flex space-x-6 items-center">
                    <a href="#" onclick="window.location.href = REPO_PATH + '/jobs.html';" class="text-slate-600 hover:text-blue-600 font-medium" data-i18n="navVacancies"></a>
                    <a href="#" onclick="window.location.href = REPO_PATH + '/resources.html';" class="text-slate-600 hover:text-blue-600 font-medium" data-i18n="navResources"></a>
                    
                    <select id="lang-selector" class="text-sm cursor-pointer bg-slate-100 border-slate-200 rounded-lg py-1 px-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="es">Español</option>
                        <option value="en">English</option>
                    </select>

                    <button id="logout-button" class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition duration-150">
                        <span data-i18n="logoutButton"></span>
                    </button>
                </nav>
            </div>
        </header>

        <main class="flex-grow max-w-4xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8">
            
            <div class="mb-8">
                <h2 class="text-3xl font-extrabold text-slate-900">
                    <span data-i18n="welcomeMessage"></span> <span id="user-name">[Nombre de Usuario]</span>!
                </h2>
                <p class="mt-2 text-lg text-slate-500" data-i18n="dashboardSubtitle"></p>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                <h3 class="text-xl font-bold text-slate-800 border-b pb-3 mb-4" data-i18n="onboardingStepsTitle"></h3>
                
                <div class="space-y-4" id="steps-container">
                    
                    <p class="text-slate-500 text-center py-4">Cargando pasos...</p>

                </div>
            </div>
        </main>
    </div>

    <script>
        // CRÍTICO: Define la ruta base del repositorio
        const REPO_PATH = '/MingaMatch'; 
        
        // Función auxiliar para redirigir, asegurando la estabilidad de la ruta
        window.redirectTo = function(path) {
            window.location.href = REPO_PATH + path;
        };

        const stepsData = [
            // Nota: Se ha ajustado el orden para que Paso 0 (documentos) aparezca primero
            { key: 'documentsPrepared', title: 'step2Title', desc: 'Guía de traductores y checklist.', href: 'onboarding-step2.html' }, 
            { key: 'agreementAccepted', title: 'step1Title', desc: 'Acuerdo de Servicio y Costos Estimados.', href: 'onboarding-step1.html' },
            { key: 'filesUploaded', title: 'step3Title', desc: 'Sube foto, video, cartas laborales y Credential Evaluation.', href: 'onboarding-step3.html' },
            { key: 'personalInfoComplete', title: 'step4Title', desc: 'Información profesional y datos personales.', href: 'onboarding-step4.html' }
        ];

        function renderSteps(status) {
            const stepsContainer = document.getElementById('steps-container');
            
            // NOTA: isPreviousStepCompleted siempre será TRUE para este dashboard
            
            stepsContainer.innerHTML = stepsData.map(step => {
                const isCompleted = status[step.key];
                
                // Determinación de Claves y Clases
                let statusKey = isCompleted ? 'statusCompleted' : 'statusPending';
                let linkKey = isCompleted ? 'statusView' : 'statusStart'; 
                
                let cardClasses = 'p-4 border rounded-lg shadow-sm';
                let statusColor = isCompleted ? 'text-green-600' : 'text-red-500';
                
                if (isCompleted) {
                    cardClasses += ' bg-green-50 border-green-400';
                } else {
                    cardClasses += ' bg-white border-blue-200';
                }

                return `
                    <div class="${cardClasses}">
                        <div class="flex items-start justify-between">
                            <div class="flex flex-col">
                                <h4 class="text-lg font-semibold text-slate-700" data-i18n="${step.title}"></h4>
                                <p class="text-sm text-slate-500 mt-1">${step.desc}</p>
                            </div>
                            <div class="flex flex-col items-end">
                                <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${statusColor}" data-i18n="${statusKey}"></span>
                                <a href="${REPO_PATH + '/' + step.href}" class="mt-2 text-sm font-medium text-blue-600 hover:underline">
                                    <span data-i18n="${linkKey}"></span> &rarr;
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
             // Llamar a la traducción para los elementos inyectados
            window.updateContent();
        }

        async function loadDashboard() {
            let status = {};
            // El estado simulado aquí muestra 1 paso completado para fines visuales.
            status = {
                documentsPrepared: true, 
                agreementAccepted: false,
                filesUploaded: false,
                personalInfoComplete: false
            };

            document.getElementById('user-name').textContent = 'María Clara'; // Simulación de nombre
            
            renderSteps(status);
            window.updateContent(); // Última pasada para asegurar la traducción del dashboard
        }

        // --- Lógica de Inicialización y Eventos ---
        document.addEventListener('i18nextInitialized', () => {
            const token = localStorage.getItem('token');
            if (!token) { return window.location.href = REPO_PATH + '/login.html'; }

            // CRÍTICO: Corrección de ruta para imágenes del header
            const logo = document.querySelector('header img');
            if (logo) {
                logo.src = REPO_PATH + '/logo-minga.png';
            }

            loadDashboard();
            
            // Lógica de Cerrar Sesión
            document.getElementById('logout-button').addEventListener('click', () => {
                localStorage.removeItem('token');
                localStorage.removeItem('role');
                window.location.href = REPO_PATH + '/index.html'; 
            });
            
            // Ajustar el selector de idioma, si aplica
            const langSelector = document.getElementById('lang-selector');
            if (langSelector) {
                langSelector.addEventListener('change', (e) => {
                    i18next.changeLanguage(e.target.value, () => {
                        loadDashboard(); // Recarga para actualizar las traducciones de los pasos
                    });
                });
            }
        });
    </script>
</body>
</html>