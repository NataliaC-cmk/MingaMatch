<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Admin | Gestionar Recursos</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

<header class="bg-slate-800 text-white shadow-md sticky top-0 z-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
            <div class="flex items-center">
                <img id="logo-img" src="logo-minga.png" alt="Minga Match Logo" class="h-8 w-auto mr-3"/>
                <span class="font-bold text-xl">Minga Match | Admin</span>
            </div>
            <div class="flex items-center gap-4">
                <a href="#" onclick="redirectTo('/admin-dashboard.html');" class="text-sm font-medium text-slate-300 hover:text-white transition">&larr; Dashboard</a>
                <button id="logout" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-sm">
                    Cerrar sesión
                </button>
            </div>
        </div>
    </div>
</header>

<main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <h1 class="text-3xl font-bold text-slate-900 mb-2">Gestión de Archivos y Recursos</h1>
    <p class="text-slate-600 mb-8">Sube y organiza los documentos de apoyo para profesores (J-1) y escuelas.</p>

    <div class="bg-white p-6 shadow-lg rounded-xl border border-slate-200 mb-8">
        <h2 class="text-xl font-bold text-slate-800 mb-4">Subir Nuevo Recurso</h2>
        <form id="upload-form" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="file-title" class="block text-sm font-medium text-slate-700">Título del Documento</label>
                    <input type="text" id="file-title" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md">
                </div>
                <div>
                    <label for="file-category" class="block text-sm font-medium text-slate-700">Categoría</label>
                    <select id="file-category" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md bg-white">
                        <option value="teacher">Recursos para Profesores (J-1)</option>
                        <option value="school">Recursos para Escuelas</option>
                        <option value="visa">Guías de Visa</option>
                    </select>
                </div>
            </div>
            <div>
                <label for="resource-file" class="block text-sm font-medium text-slate-700">Seleccionar Archivo (PDF, DOCX)</label>
                <input type="file" id="resource-file" required class="mt-1 block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            </div>
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-sm">
                Subir y Publicar
            </button>
        </form>
        <p id="upload-status" class="text-sm mt-3 h-5"></p>
    </div>

    <div class="bg-white p-6 shadow-lg rounded-xl border border-slate-200">
        <h2 class="text-xl font-bold text-slate-800 mb-4">Archivos Publicados (Mockup)</h2>
        <div class="space-y-3" id="resources-list">
            <div class="p-4 border border-gray-100 rounded-lg flex justify-between items-center bg-gray-50">
                <div>
                    <p class="font-medium text-slate-700">Guía de Evaluación de Credenciales (PDF)</p>
                    <span class="text-xs text-blue-600 font-semibold">Categoría: Profesor</span>
                </div>
                <div class="space-x-2 text-sm">
                    <button class="text-blue-500 hover:text-blue-700">Editar</button>
                    <button class="text-red-500 hover:text-red-700">Eliminar</button>
                </div>
            </div>
            <div class="p-4 border border-gray-100 rounded-lg flex justify-between items-center bg-gray-50">
                <div>
                    <p class="font-medium text-slate-700">Checklist para Entrevistas (DOCX)</p>
                    <span class="text-xs text-green-600 font-semibold">Categoría: Escuela</span>
                </div>
                <div class="space-x-2 text-sm">
                    <button class="text-blue-500 hover:text-blue-700">Editar</button>
                    <button class="text-red-500 hover:text-red-700">Eliminar</button>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    // CRÍTICO: Define la ruta base del repositorio
    const REPO_PATH = '/MingaMatch'; 
    
    // Función auxiliar para redirigir, asegurando la estabilidad de la ruta
    window.redirectTo = function(path) {
        window.location.href = REPO_PATH + path;
    };

    // --- Guardia de Sesión ---
    (function guard() {
        const token = localStorage.getItem('token');
        const role = localStorage.getItem('role');
        
        if (!token || role !== 'admin') {
            console.log('Sesión no válida o rol incorrecto. Redirigiendo a login.');
            window.location.href = REPO_PATH + '/login.html';
        }
    })();

    document.addEventListener('DOMContentLoaded', () => {
        // CRÍTICO: Corrección de la ruta del logo
        const logo = document.getElementById('logo-img');
        if (logo) {
            logo.src = REPO_PATH + '/logo-minga.png';
        }

        const uploadForm = document.getElementById('upload-form');
        const uploadStatus = document.getElementById('upload-status');
        
        // Lógica de Subida (Simulada)
        uploadForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const title = document.getElementById('file-title').value;
            const fileInput = document.getElementById('resource-file');
            
            if (fileInput.files.length === 0) {
                uploadStatus.textContent = 'Por favor, selecciona un archivo.';
                uploadStatus.classList.add('text-red-600');
                return;
            }

            const submitBtn = uploadForm.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Subiendo...';
            uploadStatus.textContent = '';
            
            // SIMULACIÓN DE SUBIDA
            setTimeout(() => {
                uploadStatus.classList.remove('text-red-600');
                uploadStatus.classList.add('text-green-600');
                uploadStatus.textContent = `¡El recurso "${title}" fue subido y publicado con éxito!`;
                
                submitBtn.textContent = 'Subir y Publicar';
                submitBtn.disabled = false;
                
                uploadForm.reset();
            }, 1800);
        });

        // --- Lógica de Logout ---
        document.getElementById('logout').addEventListener('click', () => { 
            localStorage.clear(); 
            window.location.href = REPO_PATH + '/index.html'; // Redirigir al inicio
        });
        
        // Si tienes i18n cargado, asegura la traducción (aunque esta vista es solo para admins)
        if (window.updateContent) {
            window.updateContent();
        }
    });
</script>
</body>
</html>