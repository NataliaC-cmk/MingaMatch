<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard Escuela | Minga Match</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .match-score-high { color: #10b981; } /* Emerald 500 */
        .match-score-medium { color: #f59e0b; } /* Amber 500 */
        .match-score-low { color: #ef4444; } /* Red 500 */
        .tab-btn.active {
            border-bottom-width: 2px;
            border-color: #2563eb; /* Blue 600 */
            color: #2563eb;
        }
    </style>
</head>
<body class="bg-gray-50">

<header class="bg-slate-800 text-white shadow-md sticky top-0 z-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
            <div class="flex items-center">
                <img src="/logo-minga.png" alt="Minga Match Logo" class="h-8 w-auto mr-3"/>
                <span class="font-bold text-xl">Minga Match | <span id="school-name">Escuela</span></span>
            </div>
            <div class="flex items-center gap-4">
                <a href="/resources.html" class="text-sm font-medium text-slate-300 hover:text-white transition">Recursos</a>
                <button id="logout" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                    Cerrar sesión
                </button>
            </div>
        </div>
    </div>
</header>

<main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <h1 class="text-3xl font-bold text-slate-900 mb-8">Panel de Vacantes y Candidatos</h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <div class="bg-white p-6 rounded-xl shadow border border-blue-200">
            <p class="text-sm font-medium text-blue-600">Vacantes Activas</p>
            <p id="active-vacancies" class="text-3xl font-bold text-slate-800 mt-1">0</p>
        </div>
        <div class="bg-white p-6 rounded-xl shadow border border-green-200">
            <p class="text-sm font-medium text-green-600">Candidatos en Proceso</p>
            <p id="candidates-in-progress" class="text-3xl font-bold text-slate-800 mt-1">0</p>
        </div>
        <div class="bg-white p-6 rounded-xl shadow border border-yellow-200">
            <p class="text-sm font-medium text-yellow-600">Match Pendiente de Revisión</p>
            <p id="pending-review" class="text-3xl font-bold text-slate-800 mt-1">0</p>
        </div>
    </div>

    <div class="mb-6 border-b border-gray-200">
        <nav class="flex space-x-4">
            <button data-target="vacancies-section" class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 hover:text-blue-600 active">Mis Vacantes</button>
            <button data-target="matches-section" class="tab-btn px-4 py-2 text-sm font-medium text-gray-500 hover:text-blue-600">Candidatos Match</button>
        </nav>
    </div>

    <section id="vacancies-section" class="tab-content bg-white shadow-lg rounded-xl p-6 border border-slate-200">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-slate-800">Mis Vacantes (Activas e Inactivas)</h2>
            <button id="openAddVacancyModal" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                + Crear Nueva Vacante
            </button>
        </div>
        <div id="vacanciesListContainer" class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead>
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Título</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Materia</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidatos</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                    </tr>
                </thead>
                <tbody id="vacanciesList" class="bg-white divide-y divide-gray-200">
                    </tbody>
            </table>
            <p id="noVacancies" class="px-4 py-4 text-sm text-gray-500 hidden">Aún no ha publicado ninguna vacante.</p>
        </div>
    </section>

    <section id="matches-section" class="tab-content bg-white shadow-lg rounded-xl p-6 border border-slate-200 hidden">
        <h2 class="text-xl font-bold text-slate-800 mb-4">Candidatos Sugeridos por Match Score</h2>
        
        <div id="matchesListContainer" class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead>
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidato</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vacante Match</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Match Score</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                    </tr>
                </thead>
                <tbody id="matchesList" class="bg-white divide-y divide-gray-200">
                    </tbody>
            </table>
            <p id="noMatches" class="px-4 py-4 text-sm text-gray-500 hidden">Aún no hay candidatos con un Match Score suficiente.</p>
        </div>
    </section>
</main>

<div id="vacancyModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-30 opacity-0 pointer-events-none transition-opacity">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-6 transform scale-95 transition-transform">
        <form id="vacancyForm">
            <h2 class="text-2xl font-bold text-slate-800 mb-4" id="modalVacancyTitle">Crear Nueva Vacante</h2>
            <div class="space-y-4">
                <div>
                    <label for="vacancyTitle" class="block text-sm font-medium text-slate-700">Título del Puesto</label>
                    <input type="text" id="vacancyTitle" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md">
                </div>
                <div>
                    <label for="vacancySubject" class="block text-sm font-medium text-slate-700">Materia Principal</label>
                    <select id="vacancySubject" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md">
                        <option value="">Seleccione una materia</option>
                        <option value="Matemáticas">Matemáticas</option>
                        <option value="Ciencias">Ciencias</option>
                        <option value="Inglés">Inglés/ESL</option>
                        <option value="Español">Español/Bilingüe</option>
                        <option value="Otra">Otra</option>
                    </select>
                </div>
                <div>
                    <label for="vacancyDescription" class="block text-sm font-medium text-slate-700">Descripción (Requisitos clave)</label>
                    <textarea id="vacancyDescription" rows="4" required class="mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md"></textarea>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="vacancyIsActive" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                    <label for="vacancyIsActive" class="ml-2 block text-sm text-slate-900">Activa (visible para match)</label>
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button type="button" id="closeVacancyModal" class="bg-white text-slate-700 border border-slate-300 font-bold py-2 px-4 rounded-lg hover:bg-slate-50 transition">Cancelar</button>
                <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Guardar Vacante</button>
            </div>
        </form>
    </div>
</div>

<script>
    // --- Data Mockup ---
    let vacancies = [
        { id: 'v1', title: 'Profesor de Español Bilingüe', subject: 'Español', isActive: true, candidatesCount: 4, hiredId: null },
        { id: 'v2', title: 'Maestro de Matemáticas', subject: 'Matemáticas', isActive: true, candidatesCount: 1, hiredId: null },
        { id: 'v3', title: 'Asesor Académico', subject: 'Otra', isActive: false, candidatesCount: 0, hiredId: 't101' } // Contratada
    ];

    let matches = [
        { id: 'm1', teacherId: 't101', teacherName: 'Sofía Reyes', vacancyTitle: 'Profesor de Español Bilingüe', score: 92, status: 'Revisión Pendiente' },
        { id: 'm2', teacherId: 't102', teacherName: 'Carlos Gómez', vacancyTitle: 'Maestro de Matemáticas', score: 65, status: 'Visto' },
        { id: 'm3', teacherId: 't103', teacherName: 'Ana Belén Días', vacancyTitle: 'Profesor de Español Bilingüe', score: 88, status: 'Entrevista Agendada' }
    ];

    // --- Variables DOM ---
    const vacanciesList = document.getElementById('vacanciesList');
    const matchesList = document.getElementById('matchesList');
    const vacancyModal = document.getElementById('vacancyModal');
    const vacancyForm = document.getElementById('vacancyForm');
    const schoolNameEl = document.getElementById('school-name');
    const tabs = document.querySelectorAll('.tab-btn');
    const contents = document.querySelectorAll('.tab-content');

    // --- Helpers ---
    function getMatchScoreClass(score) {
        if (score >= 80) return 'match-score-high';
        if (score >= 60) return 'match-score-medium';
        return 'match-score-low';
    }
    
    // --- Renderizado de Resumen ---
    function renderSummary() {
        document.getElementById('active-vacancies').textContent = vacancies.filter(v => v.isActive).length;
        document.getElementById('candidates-in-progress').textContent = matches.filter(m => m.status !== 'Revisión Pendiente').length;
        document.getElementById('pending-review').textContent = matches.filter(m => m.status === 'Revisión Pendiente').length;
    }

    // --- Renderizado de Vacantes ---
    function renderVacancies() {
        if (vacancies.length === 0) {
            vacanciesList.innerHTML = '';
            document.getElementById('noVacancies').classList.remove('hidden');
            return;
        }
        document.getElementById('noVacancies').classList.add('hidden');

        vacanciesList.innerHTML = vacancies.map(v => {
            const statusText = v.hiredId ? 'CONTRATADA' : (v.isActive ? 'ACTIVA' : 'INACTIVA');
            const statusColor = v.hiredId ? 'bg-indigo-100 text-indigo-800' : (v.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800');

            return `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm font-medium text-gray-900">${v.title}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">${v.subject}</td>
                    <td class="px-4 py-3 text-sm">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                            ${statusText}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-sm text-center font-bold text-blue-600">${v.candidatesCount}</td>
                    <td class="px-4 py-3 text-sm space-x-2 whitespace-nowrap">
                        <button onclick="openVacancyModal('${v.id}')" class="text-blue-600 hover:text-blue-900 text-xs font-semibold">Editar</button>
                        <button onclick="deleteVacancy('${v.id}')" class="text-red-600 hover:text-red-900 text-xs font-semibold">Eliminar</button>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // --- Renderizado de Matches ---
    function renderMatches() {
        if (matches.length === 0) {
            matchesList.innerHTML = '';
            document.getElementById('noMatches').classList.remove('hidden');
            return;
        }
        document.getElementById('noMatches').classList.add('hidden');

        matchesList.innerHTML = matches.map(m => `
            <tr class="hover:bg-gray-50">
                <td class="px-4 py-3 text-sm font-medium text-gray-900">${m.teacherName}</td>
                <td class="px-4 py-3 text-sm text-gray-500">${m.vacancyTitle}</td>
                <td class="px-4 py-3 text-sm font-bold ${getMatchScoreClass(m.score)}">${m.score}%</td>
                <td class="px-4 py-3 text-sm text-gray-600">${m.status}</td>
                <td class="px-4 py-3 text-sm space-x-2 whitespace-nowrap">
                    <a href="/teacher-profile-view.html?id=${m.teacherId}" target="_blank" class="text-blue-600 hover:text-blue-900 text-xs font-semibold">Ver Perfil</a>
                    <button onclick="updateMatchStatus('${m.id}')" class="text-green-600 hover:text-green-900 text-xs font-semibold">Contactar</button>
                </td>
            </tr>
        `).join('');
    }
    
    // --- Lógica de Vacantes (CRUD Simulado) ---
    window.openVacancyModal = (id = null) => {
        vacancyForm.reset();
        document.getElementById('modalVacancyTitle').textContent = id ? 'Editar Vacante' : 'Crear Nueva Vacante';
        vacancyForm.dataset.editingId = id;

        if (id) {
            const vacancy = vacancies.find(v => v.id === id);
            if (vacancy) {
                document.getElementById('vacancyTitle').value = vacancy.title;
                document.getElementById('vacancySubject').value = vacancy.subject;
                document.getElementById('vacancyDescription').value = `Descripción de ${vacancy.title} (Simulado)`; // Simulación de descripción
                document.getElementById('vacancyIsActive').checked = vacancy.isActive;
            }
        } else {
             document.getElementById('vacancyIsActive').checked = true;
        }
        
        vacancyModal.classList.remove('opacity-0', 'pointer-events-none');
        vacancyModal.querySelector('div').classList.remove('scale-95');
    };

    document.getElementById('openAddVacancyModal').addEventListener('click', () => openVacancyModal(null));
    document.getElementById('closeVacancyModal').addEventListener('click', () => {
        vacancyModal.classList.add('opacity-0', 'pointer-events-none');
        vacancyModal.querySelector('div').classList.add('scale-95');
    });

    vacancyForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = vacancyForm.dataset.editingId;
        const title = document.getElementById('vacancyTitle').value;
        const subject = document.getElementById('vacancySubject').value;
        const isActive = document.getElementById('vacancyIsActive').checked;
        
        if (id) {
            // Edición
            const index = vacancies.findIndex(v => v.id === id);
            if (index !== -1) {
                vacancies[index] = { ...vacancies[index], title, subject, isActive };
                alert(`Vacante "${title}" actualizada.`);
            }
        } else {
            // Creación
            const newVacancy = { id: 'v' + Date.now(), title, subject, isActive, candidatesCount: 0, hiredId: null };
            vacancies.push(newVacancy);
            alert(`Nueva vacante "${title}" creada.`);
        }

        document.getElementById('closeVacancyModal').click();
        renderVacancies();
        renderSummary();
    });

    window.deleteVacancy = (id) => {
        if (!confirm('¿Está seguro de que desea eliminar esta vacante?')) return;
        vacancies = vacancies.filter(v => v.id !== id);
        alert('Vacante eliminada.');
        renderVacancies();
        renderSummary();
    };

    window.updateMatchStatus = (id) => {
        const match = matches.find(m => m.id === id);
        if (match) {
            match.status = 'Entrevista Agendada';
            alert(`Candidato ${match.teacherName} marcado para Entrevista Agendada.`);
            renderMatches();
            renderSummary();
        }
    }
    
    // --- Funcionalidad de Pestañas ---
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const target = tab.dataset.target;
            
            tabs.forEach(t => {
                t.classList.remove('active');
            });
            tab.classList.add('active');

            contents.forEach(content => {
                content.classList.add('hidden');
                if (content.id === target) {
                    content.classList.remove('hidden');
                }
            });
        });
    });

    // --- Inicialización ---
    (function init() {
        // Simulación: establecer el nombre de la escuela
        schoolNameEl.textContent = 'High School Central'; 
        
        // Carga inicial de datos
        renderSummary();
        renderVacancies();
        renderMatches();
        
        // Configurar pestañas
        document.querySelector('.tab-btn[data-target="vacancies-section"]').click();

        document.getElementById('logout').addEventListener('click', () => { 
            localStorage.clear(); 
            location.href = '/login.html'; 
        });
    })();
</script>

</body>
</html>

